# Доказательство, почему predict + complete работают быстро на каждом слое

Цикл while работает не более линейного числа раз от длины слова, а predict работает за константу от слова, поэтому predict можно не менять.

Чтобы complete работал достаточно быстро, во время каждой пары predict-complete я все новые ситуации сохраняю отдельно, а потом обрабатываю в complete только их. 

В complete нас интересуют только ситуации следующих видов:

(1) (A -> a.Bb, i, k)

                        - (a -> aB.b, i, j)

(2) (B -> c., k, j)

Я храню вектор check[k][B], куда сохраняю, рассматривал ли я ситуацию (2) с подобными параметрами, так как при рассмотрении фиксированного слоя только они меня интересуют. Поэтому на каждом complete с новыми элементами я сначала прохожусь по все новым элементам и смотрю на ситуации с точкой в конце. Потом проверяю соответствующий check[k][B], и если он true, то, значит, из всех ситуаций вида (1) из старых элементов уже выводились новые, а если значение false, то делаю действия из обычного complete. Потом я прохожусь только по новым ситуациям вида (1) и проверяю для них check[k][B], где k - это слой, который рассматривается прямо сейчас, потому что данная ситуация была добавлена на данном слое. И если данный check - true, то среди старых и новых элементов встречалась соответствующая ситуация вида (2), и можно обновиться за константу, иначе не встречалась.

По итогу все операции complete отработают по разу для каждой ситуации вида (2), а каждая ситуация вида (1) будет рассмотрена за константу, благодаря чему сохраняется хорошая асимптотика.